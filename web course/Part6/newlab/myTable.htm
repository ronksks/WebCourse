<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Editable Table</title>
    <link href="inc/bootstrap.min.css" rel="stylesheet" />
    <script src="inc/jquery-3.0.0.min.js"></script>
    <script>
        index = 0;
        $(document).ready(function () {
            if (localStorage.users) {
                var temp_arr = JSON.parse(localStorage.users);
                temp_arr.forEach(function (val, i, arr) {
                    markup = "<tr> \
                        <th style='width:30px' id='index" + val.index + "'>" + val.index + "</th>\
                        <th style='width:120px'><input id='name" + val.index + "' value='" + val.name + "' /></th>\
                        <th style='width:60px'><input type='integer' id='age" + val.index + "' value='" + val.age + "' /></th>\
                        <th><input id='address" + val.index + "' value='" + val.address + "'/>\
                        <button class='btn-sm btn-danger' style='float:right;' onclick='del_raw("+val.index+")'>x</button></th>\
                    </tr>";
                    index++;
                    $("#tbStudents").append(markup);
                })
            }
        });
        function user_alreay_exists(arr, obj) {
            //console.log("checking if " + obj + " exists");
            arr.forEach(function (val, index, array) {
                //console.log("comparing:" + val.name + val.age + val.address);
                //console.log("to:" + obj.name + obj.age + obj.address);
                if (val.name == obj.name && val.age == obj.age && val.address == val.address) {
                    //console.log("comparison is true!")
                    return true;
                }
            });
            return false;
        }

        function Save() {
            var students = [];
            $("#tbStudents > tbody > tr").each(function (ii, tr) {
                i = tr.find("first-child").val();
                name = $("#name" + i).val();
                age = $("#age" + i).val();
                address = $("#address" + i).val();
                if (!name || !age || !address) {
                    console.log("index:" + i + " is empty. skipping.");
                    return;
                }
                console.log("saving index:" + i + " - name:" + name + " - age:" + age + " - address:" + address);
                newUser = { 'index': i, 'name': name, 'age': age, 'address': address };
                console.log(newUser);
                //if its not empty we a to it otherwise we insert first new user to list
                if (user_alreay_exists(students, newUser)) {
                    console.log("duplicate newUser found. skipping insertion.");
                    return;
                } else {
                    students.push(newUser);
                }
            });
            localStorage.users = JSON.stringify(students);
            console.log(localStorage); 
        }

        function AddNew() {
            console.log("new line clicked!");
            markup = "<tr> \
                    <th style='width:30px' id='index" + index + "'>" + index + "</th>\
                    <th style='width:120px'><input id='name" + index + "' \></th>\
                    <th style='width:60px'><input type='integer' id='age" + index + "' \></th>\
                    <th><input id='address" + index + "' \></th>\
                    <th><button class='btn btn-danger' onclick='del_raw("+index+")'>x</button></th>\
                </tr>";
            index++;
            $("#tbStudents").append(markup);
        }
        function del_raw(i) {
            $("#index" + i).parent().remove();
        }
        function Cancel() {
            for (i = 0; i < index; i++) {
                typeof($("#id" + i).before())
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <div><small>Editable table example</small></div>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarColor01">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" type="text" placeholder="Search">
                    <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
                </form>
            </div>
        </nav>
        <h1>Students</h1>
        <hr />
        <div>
            <div style="float:left">
                <button class="btn btn-info" onclick="AddNew()">Add New</button>
            </div>
            <div style="float:right" id="divTemp">
                <button class="btn btn-success" onclick="Save()">Save</button>
                <button class="btn btn-danger" onclick="Cancel()">Cancel</button>
            </div>
            <div style="clear:both"></div>

        </div>
        <table id="tbStudents" class="table table-bordered table-sm" style="margin-top:20px;">
            <thead>
                <tr>
                    <th style="width:30px">N#</th>
                    <th style="width:120px">Name</th>
                    <th style="width:60px">Age</th>
                    <th>Address</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <div class="text-center" id="divEmpty">No students in db..</div>
    </div>


</body>
</html>